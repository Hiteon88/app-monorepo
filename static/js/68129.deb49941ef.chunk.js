"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[68129],{389587:(e,r,t)=>{t.d(r,{K:()=>n});var n=80},82506:(e,r,t)=>{t.d(r,{d:()=>useDebounce});var n=t(578104);function useDebounce(e,r,t){var[a]=(0,n.d7)(e,r,t);return a}},471230:(e,r,t)=>{t.d(r,{YG:()=>y,U9:()=>a.U});t(490343),t(791088),t(338117);var n=t(498356);t(831085);var a=t(952954),o=t(324586),i=t(586330),s=t(514041),l=t(471169),c=t(318822),d=(t(254491),t(663522)),u=t(584186),f=t(222007),m=t(131397),p=t(621591);function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,o.A)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var b=0,g=!1,h=!1;var y=(0,s.memo)((function OnboardingOnMountCmp(){var e=(0,m.t1)(),r=(0,n.A)(),t=(0,p.D)(),[a,o]=(0,l.useV4migrationPersistAtom)(),y=a?.downgradeWarningConfirmed;(0,s.useRef)(y).current=y;var v=(0,s.useCallback)((0,i.A)((function*(){(yield f.A.serviceV4Migration.checkShouldMigrateV4OnMount())&&(g||(g=!0,yield f.A.serviceV4Migration.migrateBaseSettings()))})),[]),w=(0,s.useCallback)((0,i.A)((function*({checkingV4Migration:r}={}){try{if(r)if(yield f.A.serviceV4Migration.checkShouldMigrateV4OnMount()){if(yield v(),yield u.A.wait(600),!h){h=!0,yield t.navigateToV4MigrationPage({isAutoStartOnMount:!0});var n=Date.now();n-b>3e3&&(b=n,o((function(e){return _objectSpread(_objectSpread({},e),{},{v4migrationAutoStartCount:(e.v4migrationAutoStartCount||0)+1})})))}return}}catch(e){}if(!(0,m.p1)()){var{isOnboardingDone:a}=yield f.A.serviceOnboarding.isOnboardingDone();a||d.Ay.isWebDappMode||e({isFullModal:!0})}})),[v,o,e,t]),k=(0,s.useCallback)((0,i.A)((function*(){yield w({checkingV4Migration:!0})})),[w,v,o]);return(0,s.useEffect)((function(){}),[]),(0,s.useEffect)((function(){}),[o]),(0,s.useEffect)((function(){}),[r]),(0,s.useEffect)((function(){}),[t]),(0,s.useEffect)((function(){k()}),[k]),(0,s.useEffect)((function(){var fn=function(){w({checkingV4Migration:!1})};return c.iL.on(c.Tu.WalletClear,fn),function(){c.iL.off(c.Tu.WalletClear,fn)}}),[w]),null}))},68129:(e,r,t)=>{t.r(r),t.d(r,{default:()=>I});var n=t(586330),a=t(514041),o=t(908867),i=t(490343),s=t(222007),l=t(325809),c=t(575995),d=t(660395),u=t(370968),f=t(389587),m=t(498356),p=t(82506),b=t(911998),g=t(162616),h=t(147882),y=t(625931),v=t(181447),w=t(254491),k=t(558726),A=t(714191),E=t(471230),x=t(831085),j=function(e){return e.Address="Address",e.PublicKey="PublicKey",e}(j||{}),FormDeriveTypeInput=function({networkId:e,deriveInfoItems:r,fieldName:t}){var n=(0,o.A)();return(0,x.jsx)(i.Stack,{mt:"$2",children:(0,x.jsx)(i.Form.Field,{label:n.formatMessage({id:w.ETranslations.derivation_path}),name:t,children:(0,x.jsx)(c.l$,{networkId:e,enabledItems:r,renderTrigger:function({label:e,onPress:r}){return(0,x.jsxs)(i.Stack,{userSelect:"none",flexDirection:"row",px:"$3.5",py:"$2.5",borderWidth:1,borderColor:"$borderStrong",borderRadius:"$3",$gtMd:{px:"$3",py:"$1.5",borderRadius:"$2"},borderCurve:"continuous",hoverStyle:{bg:"$bgHover"},pressStyle:{bg:"$bgActive"},onPress:r,children:[(0,x.jsx)(i.SizableText,{flex:1,children:e}),(0,x.jsx)(i.Icon,{name:"ChevronDownSmallOutline",color:"$iconSubdued",mr:"$-0.5"})]})}})})})};function ImportAddress(){var e=(0,o.A)(),r=(0,i.useMedia)(),t=(0,m.A)(),{result:c}=(0,b.yk)((0,n.A)((function*(){var e=yield s.A.serviceNetwork.getPublicKeyExportOrWatchingAccountEnabledNetworks(),r=e.map((function(e){return e.network.id})),t=e.filter((function(e){return e.publicKeyExportEnabled})).map((function(e){return e.network.id})),n=e.filter((function(e){return e.watchingAccountEnabled})).map((function(e){return e.network.id}));return{networkIds:r,publicKeyExportEnabled:new Set(t),watchingAccountEnabled:new Set(n)}})),[],{initResult:{networkIds:[],publicKeyExportEnabled:new Set([]),watchingAccountEnabled:new Set([])}}),A=(0,g.z$)(),[I,M]=(0,a.useState)(j.Address),{activeAccount:{network:S}}=(0,d.w)({num:0}),{clearText:_}=(0,i.useClipboard)(),T=(0,i.useForm)({values:{networkId:S?.id&&S.id!==(0,y.V)().onekeyall?S?.id:(0,y.V)().btc,deriveType:void 0,publicKeyValue:"",addressValue:{raw:"",resolved:void 0},accountName:""},mode:"onChange",reValidateMode:"onBlur"}),{setValue:O,control:V}=T,[P,C]=(0,a.useState)(),F=(0,a.useRef)(!1),K=(0,i.useFormWatch)({control:V,name:"networkId"}),N=(0,i.useFormWatch)({control:V,name:"publicKeyValue"}),$=(0,i.useFormWatch)({control:V,name:"addressValue"}),D=(0,i.useFormWatch)({control:V,name:"accountName"}),W=(0,p.d)(N.trim(),600),R=(0,p.d)(D?.trim()||"",600),z=(0,a.useCallback)((0,n.A)((function*(){if(R)try{yield s.A.serviceAccount.ensureAccountNameNotDuplicate({name:R,walletId:v.Hk}),T.clearErrors("accountName")}catch(e){T.setError("accountName",{message:e?.message})}else T.clearErrors("accountName");if(O("deriveType",void 0),W&&K){var e=yield s.A.servicePassword.encodeSensitiveText({text:W});try{if(!c.publicKeyExportEnabled.has(K))throw new Error(`Network not supported: ${K}`);var r=yield s.A.serviceAccount.validateGeneralInputOfImporting({input:e,networkId:K,validateXpub:!0});C(r)}catch(e){C({isValid:!1})}}else C(void 0)})),[R,O,W,K,T,c.publicKeyExportEnabled]);(0,a.useEffect)((function(){(0,n.A)((function*(){try{F.current=!0,yield z()}finally{F.current=!1}}))()}),[z]);var H,{start:B}=(0,h.A)(),U=(T.watch("deriveType"),(0,a.useMemo)((function(){return!Object.values(T.formState.errors).length&&(I===j.Address?!$.pending&&T.formState.isValid:P?.isValid)}),[I,$.pending,P,T.formState])),L=(0,a.useMemo)((function(){return K&&c.publicKeyExportEnabled.has(K)}),[K,c.publicKeyExportEnabled]),q=(0,a.useMemo)((function(){return I===j.PublicKey&&L}),[I,L]);return(0,x.jsxs)(i.Page,{children:[(0,x.jsx)(i.Page.Header,{title:e.formatMessage({id:w.ETranslations.global_import_address})}),(0,x.jsxs)(i.Page.Body,{px:"$5",children:[(0,x.jsxs)(i.Form,{form:T,children:[(0,x.jsx)(i.Form.Field,{label:e.formatMessage({id:w.ETranslations.global_network}),name:"networkId",children:(0,x.jsx)(l.YS,{networkIds:c.networkIds})}),L?(0,x.jsx)(i.SegmentControl,{fullWidth:!0,value:I,onChange:function(e){M(e)},options:[{label:e.formatMessage({id:w.ETranslations.global_address}),value:j.Address},{label:e.formatMessage({id:w.ETranslations.global_public_key}),value:j.PublicKey}]}):null,q?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(i.Form.Field,{label:e.formatMessage({id:w.ETranslations.global_public_key}),name:"publicKeyValue",children:(0,x.jsx)(i.Input,{secureTextEntry:!1,placeholder:e.formatMessage({id:w.ETranslations.form_public_key_placeholder}),testID:"import-address-input",size:r.gtMd?"medium":"large",onPaste:_,addOns:[{iconName:"ScanOutline",onPress:(H=(0,n.A)((function*(){var e=yield B({handlers:[],autoHandleResult:!1});T.setValue("publicKeyValue",e.raw)})),function onPress(){return H.apply(this,arguments)})}]})}),P?.deriveInfoItems?(0,x.jsx)(FormDeriveTypeInput,{fieldName:"deriveType",networkId:T.getValues().networkId||"",deriveInfoItems:P?.deriveInfoItems||[]}):null,(0,x.jsx)(x.Fragment,{children:P&&!P?.isValid&&W?(0,x.jsx)(i.SizableText,{size:"$bodyMd",color:"$textCritical",children:e.formatMessage({id:w.ETranslations.form_public_key_error_invalid})}):null})]}):null,q?null:(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(i.Form.Field,{label:e.formatMessage({id:w.ETranslations.global_address}),name:"addressValue",rules:{validate:(0,u.j)({defaultErrorMessage:e.formatMessage({id:w.ETranslations.form_address_error_invalid})})},children:(0,x.jsx)(u.N,{placeholder:e.formatMessage({id:w.ETranslations.form_address_placeholder}),networkId:null!=K?K:"",testID:"import-address-input"})})}),(0,x.jsx)(i.Form.Field,{label:e.formatMessage({id:w.ETranslations.form_enter_account_name}),name:"accountName",children:(0,x.jsx)(i.Input,{maxLength:f.K,placeholder:e.formatMessage({id:w.ETranslations.form_enter_account_name_placeholder})})})]}),(0,x.jsx)(E.U9,{list:[{title:e.formatMessage({id:w.ETranslations.faq_watched_account}),description:e.formatMessage({id:w.ETranslations.faq_watched_account_desc})}]}),null]}),(0,x.jsx)(i.Page.Footer,{confirmButtonProps:{disabled:!U},onConfirm:(0,n.A)((function*(){var r;yield T.handleSubmit((r=(0,n.A)((function*(r){var n,a,o,l,c=q?{name:r.accountName,input:null!=(n=r.publicKeyValue)?n:"",networkId:null!=(a=r.networkId)?a:"",deriveType:r.deriveType,shouldCheckDuplicateName:!0}:{name:r.accountName,input:null!=(o=r.addressValue.resolved)?o:"",networkId:null!=(l=r.networkId)?l:"",shouldCheckDuplicateName:!0},d=yield s.A.serviceAccount.addWatchingAccount(c),u=d?.accounts?.[0]?.id;u&&i.Toast.success({title:e.formatMessage({id:w.ETranslations.global_success})}),A.current.updateSelectedAccountForSingletonAccount({num:0,networkId:r.networkId,walletId:v.Hk,othersWalletAccountId:u}),t.popStack(),k.U.account.wallet.importWallet({importMethod:"address"})})),function(e){return r.apply(this,arguments)}))()}))})]})}const I=function ImportAddressPage(){return(0,x.jsx)(l.b8,{config:{sceneName:A.Zs.home},enabledNum:[0],children:(0,x.jsx)(ImportAddress,{})})}}}]);